<UserControl x:Class="NetworkService.Views.EntitiesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:helpers="clr-namespace:NetworkService.Helpers"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d">
    <UserControl.Resources>
        <helpers:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
    </UserControl.Resources>
    <Grid Background="{StaticResource Clr.Bg}" Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.6*"/>
            <ColumnDefinition Width="32"/>
            <ColumnDefinition Width="440"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

       
        <TextBlock Grid.ColumnSpan="3"
                   Style="{StaticResource Txt.Title}"
                   Text="Network Entities"
                   Margin="0,0,0,12"/>


        <Border Grid.Row="1" Grid.Column="0"
        Style="{StaticResource Card}"
        Padding="12" 
        Margin="0,8,0,0"
                Grid.ColumnSpan="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>

                </Grid.ColumnDefinitions>


                <TextBlock Grid.Column="0" Text="Type:" VerticalAlignment="Center"
               Style="{StaticResource Txt.Label}" Margin="0,0,8,0"/>
                <ComboBox Grid.Column="1" VerticalAlignment="Center"
              ItemsSource="{Binding SensorTypes}"
              SelectedItem="{Binding SelectedTypeFilter, Mode=TwoWay}"
              DisplayMemberPath="Name"/>


                <TextBlock Grid.Column="3" Text="ID:" VerticalAlignment="Center"
               Style="{StaticResource Txt.Label}" Margin="0,0,8,0"/>

                <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                    <RadioButton Content="&lt;" GroupName="IdOp" Margin="0,0,6,0"
                   IsChecked="{Binding IdCompare, Mode=TwoWay,
                                       Converter={StaticResource EnumToBoolConverter},
                                       ConverterParameter=Less}"/>
                    <RadioButton Content="=" GroupName="IdOp" Margin="0,0,6,0"
                   IsChecked="{Binding IdCompare, Mode=TwoWay,
                                       Converter={StaticResource EnumToBoolConverter},
                                       ConverterParameter=Equal}"/>
                    <RadioButton Content="&gt;" GroupName="IdOp"
                   IsChecked="{Binding IdCompare, Mode=TwoWay,
                                       Converter={StaticResource EnumToBoolConverter},
                                       ConverterParameter=Greater}"/>
                </StackPanel>


                <TextBox Grid.Column="6" VerticalAlignment="Center"
             Text="{Binding IdFilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                <Button Grid.Column="8" Content="Clear" MinWidth="90" VerticalAlignment="Center"
            Command="{Binding ClearFilterCommand}"/>
            </Grid>
        </Border>


        <Border Grid.Row="2" Grid.Column="0"
        Background="{StaticResource Clr.Surface}"
        BorderBrush="{StaticResource Clr.Border}"
        BorderThickness="1"
        CornerRadius="10"
        Padding="0"
        Margin="0,12,0,0">
            <Border CornerRadius="10" ClipToBounds="True" Background="{StaticResource Clr.Surface}">
                <DataGrid ItemsSource="{Binding FilteredEntities}"
              SelectedItem="{Binding SelectedEntity, Mode=TwoWay}"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              CanUserDeleteRows="False"
              Background="Transparent"
              BorderThickness="0"
              HeadersVisibility="Column">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="SizeToCells"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
                        <DataGridTextColumn Header="Type" Binding="{Binding Type.Name}" Width="2*"/>
                        <DataGridTextColumn Header="Last Value" Binding="{Binding LastValue, StringFormat=F2}" Width="*"/>
                        <DataGridTemplateColumn Header="Image" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Image Source="{Binding Type.ImagePath}"
                     Width="28" Height="28" Stretch="Uniform"
                     HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Border>


        <Border Grid.Row="2" Grid.Column="2" Style="{StaticResource Card}" Margin="0,12,0,0">
            <StackPanel>
                <TextBlock Text="Add new entity" Style="{StaticResource Txt.Title}" FontSize="16" Margin="0,0,0,12"/>

                <TextBlock Text="ID" Style="{StaticResource Txt.Label}"/>
                <TextBox Text="{Binding Current.Id, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4"/>

                <TextBlock Style="{StaticResource Txt.Error}" Text="{Binding Current.ValidationErrors[Id]}" Margin="0,2,0,8"/>

                <TextBlock Text="Name" Style="{StaticResource Txt.Label}"/>
                <TextBox Text="{Binding Current.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4"/>

                <TextBlock Style="{StaticResource Txt.Error}" Text="{Binding Current.ValidationErrors[Name]}" Margin="0,2,0,8"/>

                <TextBlock Text="Type" Style="{StaticResource Txt.Label}"/>
                <ComboBox ItemsSource="{Binding SensorTypes}"
                  SelectedItem="{Binding Current.Type, Mode=TwoWay}"
                  DisplayMemberPath="Name" Margin="0,0,0,4"/>
                <TextBlock Style="{StaticResource Txt.Error}" Text="{Binding Current.ValidationErrors[Type]}" Margin="0,2,0,12"/>

                <StackPanel Orientation="Horizontal" Margin="0,8,0,0" HorizontalAlignment="Right">
                    <Button Content="Add" Width="110" Command="{Binding AddCommand}"/>
                    <Button Content="Delete" Width="110" Margin="8,0,0,0" Command="{Binding DeleteCommand}"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
